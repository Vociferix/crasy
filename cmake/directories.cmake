macro(setonce VAR)
    if(NOT DEFINED ${VAR})
        set(${VAR} ${ARGN})
    endif()
endmacro()

if(WIN32 AND TOP_LEVEL_PROJECT)
    set(CMAKE_INSTALL_BINDIR "." STRING CACHE "Binary installation directory")
    set(CMAKE_INSTALL_LIBDIR "." STRING CACHE "Library installation directory")
    mark_as_advanced(CMAKE_INSTALL_BINDIR CMAKE_INSTALL_LIBDIR)
endif()
include(GNUInstallDirs)

setonce(OUTPUT_DIR "${PROJECT_BINARY_DIR}/output")
setonce(OUTPUT_BINDIR "${OUTPUT_DIR}/${CMAKE_INSTALL_BINDIR}")
setonce(OUTPUT_LIBDIR "${OUTPUT_DIR}/${CMAKE_INSTALL_LIBDIR}")
setonce(OUTPUT_INCLUDEDIR "${OUTPUT_DIR}/${CMAKE_INSTALL_INCLUDEDIR}")

file(MAKE_DIRECTORY "${OUTPUT_INCLUDEDIR}/crasy")

set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY "${OUTPUT_LIBDIR}")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY "${OUTPUT_LIBDIR}")
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${OUTPUT_BINDIR}")
foreach(CFG ${CMAKE_CONFIGURATION_TYPES})
    string(TOUPPER "${CFG}" CFG)
    set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_${CFG} "${OUTPUT_LIBDIR}")
    set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_${CFG} "${OUTPUT_LIBDIR}")
    set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_${CFG} "${OUTPUT_BINDIR}")
endforeach()
